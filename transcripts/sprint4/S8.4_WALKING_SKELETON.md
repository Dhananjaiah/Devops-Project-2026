# S8.4: Walking Skeleton Deployment

**Video Duration:** ~10 minutes  
**Story Points:** 3

---

## Learning Objectives

By the end of this video, you will be able to:
- Deploy all microservices end-to-end
- Verify service communication
- Test the complete application
- Debug common deployment issues

---

## Transcript

### Introduction (0:00 - 1:00)

Welcome back! We have all the pieces - Docker images, Helm charts, ArgoCD, monitoring. Let's put it all together and deploy the complete walking skeleton!

### What is a Walking Skeleton? (1:00 - 2:00)

A walking skeleton is a minimal end-to-end implementation that:
- Touches all layers of architecture
- Proves components can communicate
- Establishes the deployment pipeline
- Has minimal features but full connectivity

Think of it as a "hello world" for the entire system.

### Building and Pushing All Images (2:00 - 4:00)

```bash
cd techitfactory-app

# Login to ECR
aws ecr get-login-password --region ap-south-1 | \
  docker login --username AWS --password-stdin $ACCOUNT.dkr.ecr.ap-south-1.amazonaws.com

# Build and push all services
for service in api-gateway product order cart user-service frontend; do
  path="services/${service%%-service}"
  [ "$service" == "user-service" ] && path="services/user-service"
  [ "$service" == "api-gateway" ] && path="services/api-gateway"
  [ "$service" == "frontend" ] && path="services/frontend"
  
  docker build -t $ACCOUNT.dkr.ecr.ap-south-1.amazonaws.com/techitfactory/$service:latest $path
  docker push $ACCOUNT.dkr.ecr.ap-south-1.amazonaws.com/techitfactory/$service:latest
done
```

*[Shows images being pushed]*

### Updating GitOps Repo (4:00 - 5:00)

```bash
cd techitfactory-gitops

# Update image tags
find environments/dev -name "kustomization.yaml" -exec \
  sed -i "s/<AWS_ACCOUNT>/$ACCOUNT/g" {} \;

git add .
git commit -m "Update ECR registry"
git push
```

### Syncing in ArgoCD (5:00 - 6:30)

```bash
argocd app sync root-app

# Watch the magic
argocd app list
```

*[Shows ArgoCD syncing all apps]*

All six services are syncing!

```bash
kubectl get pods -n techitfactory -w
```

*[Shows pods starting]*

### Testing End-to-End (6:30 - 8:30)

```bash
# Forward API Gateway
kubectl port-forward svc/api-gateway -n techitfactory 3001:80 &

# Test health
curl http://localhost:3001/health
# {"status": "healthy", "service": "api-gateway"}

# Test products endpoint
curl http://localhost:3001/api/products
# [{"id": 1, "name": "Laptop"}, ...]

# Test orders endpoint
curl http://localhost:3001/api/orders
# [{"id": 1, "status": "pending"}, ...]

# Test frontend
kubectl port-forward svc/frontend -n techitfactory 8080:80 &
# Open http://localhost:8080
```

*[Shows working frontend]*

The frontend calls the API Gateway, which calls the backend services. Everything is connected!

### Debugging Tips (8:30 - 9:30)

Common issues and fixes:

**Pods in CrashLoopBackOff:**
```bash
kubectl logs deployment/api-gateway -n techitfactory
```

**Image pull errors:**
```bash
kubectl describe pod <pod-name> -n techitfactory
# Check: Image name, ECR permissions
```

**Service not reachable:**
```bash
kubectl get svc -n techitfactory
kubectl get endpoints -n techitfactory
```

### Summary (9:30 - 10:00)

We deployed:
1. All 6 microservices
2. Verified inter-service communication
3. Tested frontend to backend flow
4. Complete walking skeleton working!

Congratulations! The platform is operational!

---

## Key Takeaways

- Walking skeleton proves end-to-end integration
- ArgoCD deploys everything from GitOps repo
- Service discovery works via Kubernetes DNS
- Debug with kubectl logs, describe, and port-forward
- This foundation is ready for feature development
