# S4.4: Baseline Add-ons Installation

**Video Duration:** ~10 minutes  
**Story Points:** 2

---

## Learning Objectives

By the end of this video, you will be able to:
- Install Metrics Server for HPA
- Understand CoreDNS configuration
- Set up essential cluster add-ons
- Verify add-on functionality

---

## Transcript

### Introduction (0:00 - 1:00)

Welcome back! Before we can run applications, we need some baseline add-ons. These are the supporting services that make Kubernetes actually useful.

### Essential Add-ons Overview (1:00 - 2:00)

Here's what we need:

1. **Metrics Server** - Exposes CPU/memory metrics for HPA
2. **CoreDNS** - Already installed, but we'll verify
3. **AWS VPC CNI** - Already installed, EKS default
4. **kube-proxy** - Already installed

We'll focus on Metrics Server since it's not installed by default.

### Installing Metrics Server (2:00 - 4:00)

```bash
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
```

Simple! Let's verify:

```bash
kubectl get deployment metrics-server -n kube-system
kubectl get pods -n kube-system -l k8s-app=metrics-server
```

Wait a minute for it to start collecting metrics:

```bash
kubectl top nodes
```

*[Shows CPU and memory for nodes]*

```bash
kubectl top pods -A
```

*[Shows pod metrics]*

Now Horizontal Pod Autoscaler will work!

### Verifying CoreDNS (4:00 - 5:30)

CoreDNS provides DNS resolution inside the cluster:

```bash
kubectl get deployment coredns -n kube-system
kubectl get pods -n kube-system -l k8s-app=kube-dns
```

Let's test it:

```bash
kubectl run test-dns --image=busybox --rm -it --restart=Never -- nslookup kubernetes.default
```

*[Shows successful DNS resolution]*

DNS is working. Services can discover each other by name.

### Verifying VPC CNI (5:30 - 6:30)

The VPC CNI gives pods real IP addresses from your VPC:

```bash
kubectl get daemonset aws-node -n kube-system
kubectl get pods -n kube-system -l k8s-app=aws-node
```

Each node has an aws-node pod. Let's check IP configuration:

```bash
kubectl get pods -A -o wide
```

See how pod IPs are in the 10.0.x.x range? That's your VPC CIDR! Pods get real VPC IPs.

### EKS Managed Add-ons (6:30 - 8:00)

EKS can manage some add-ons for you:

```hcl
resource "aws_eks_addon" "vpc_cni" {
  cluster_name = aws_eks_cluster.main.name
  addon_name   = "vpc-cni"
}

resource "aws_eks_addon" "coredns" {
  cluster_name = aws_eks_cluster.main.name
  addon_name   = "coredns"
}

resource "aws_eks_addon" "kube_proxy" {
  cluster_name = aws_eks_cluster.main.name
  addon_name   = "kube-proxy"
}
```

Benefits of managed add-ons:
- Automatic updates
- AWS-tested versions
- Terraform-managed

I've already added these to our EKS module.

### Quick Health Check (8:00 - 9:30)

Let's do a full health check:

```bash
# Nodes healthy?
kubectl get nodes

# System pods running?
kubectl get pods -n kube-system

# Metrics working?
kubectl top nodes

# DNS working?
kubectl run test --image=busybox --rm -it --restart=Never -- wget -qO- http://kubernetes.default.svc/healthz
```

All green! Our cluster is production-ready.

### Summary (9:30 - 10:00)

We verified and installed:
1. Metrics Server for resource monitoring
2. CoreDNS for service discovery
3. VPC CNI for pod networking
4. kube-proxy for service routing

The baseline is ready! Next: ALB Controller!

---

## Key Takeaways

- Metrics Server enables Horizontal Pod Autoscaler
- CoreDNS provides in-cluster DNS resolution
- VPC CNI gives pods real VPC IP addresses
- EKS can manage add-ons automatically
- Always verify add-ons after cluster creation
