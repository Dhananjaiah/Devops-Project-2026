# S7.2: Grafana Dashboards and Alerting

**Video Duration:** ~10 minutes  
**Story Points:** 2

---

## Learning Objectives

By the end of this video, you will be able to:
- Navigate Grafana interface
- Import community dashboards
- Create custom dashboards
- Set up alert rules

---

## Transcript

### Introduction (0:00 - 0:30)

Welcome back! Prometheus collects metrics, but Grafana makes them beautiful and actionable. Let's explore!

### Grafana Overview (0:30 - 2:00)

*[Shows Grafana interface]*

The main sections:
- **Dashboards** - Where visualizations live
- **Explore** - Ad-hoc querying
- **Alerting** - Alert rules and notifications
- **Configuration** - Data sources and settings

Our Prometheus is already configured as a data source - the Helm chart did that for us.

### Importing Community Dashboards (2:00 - 4:00)

Let's import a popular dashboard:

1. Go to Dashboards → Import
2. Enter ID: `15757` (Kubernetes Cluster Overview)
3. Select Prometheus data source
4. Click Import

*[Shows beautiful cluster dashboard]*

Node CPU, memory, pod counts, network I/O - all in one view!

Let me import a few more:
- `14981` - Kubernetes API Server
- `13639` - Loki Logs (we'll use this later)

### Creating Custom Dashboards (4:00 - 6:30)

Let's create a TechITFactory app dashboard:

*[Clicks New Dashboard → Add Panel]*

```promql
sum(rate(http_requests_total{namespace="techitfactory"}[5m])) by (service)
```

*[Configures visualization]*

This shows requests per second for each service.

Add another panel for error rate:

```promql
sum(rate(http_requests_total{namespace="techitfactory", status=~"5.."}[5m])) / sum(rate(http_requests_total{namespace="techitfactory"}[5m])) * 100
```

And latency P95:

```promql
histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{namespace="techitfactory"}[5m])) by (le, service))
```

*[Shows custom dashboard with 3 panels]*

Save as "TechITFactory Overview"!

### Setting Up Alerts (6:30 - 8:30)

Let's create an alert for high error rate:

*[Goes to Alerting → Alert Rules → New]*

```yaml
Name: High Error Rate
Condition: > 1%
For: 5 minutes
Query: 
  sum(rate(http_requests_total{status=~"5.."}[5m])) 
  / 
  sum(rate(http_requests_total[5m])) * 100
```

*[Configures alert]*

When error rate exceeds 1% for 5 minutes, this fires.

For notifications, configure a contact point:
- Slack webhook
- Email
- PagerDuty

### Dashboards as Code (8:30 - 9:30)

Best practice: Store dashboards as ConfigMaps!

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: techitfactory-dashboard
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  techitfactory.json: |
    {
      "title": "TechITFactory Overview",
      "panels": [...]
    }
```

Grafana automatically detects ConfigMaps with the `grafana_dashboard` label and imports them!

### Summary (9:30 - 10:00)

We learned:
1. Importing community dashboards
2. Creating custom visualizations
3. Writing PromQL queries
4. Setting up alert rules
5. Storing dashboards as code

Next: Logging with Loki!

---

## Key Takeaways

- Community dashboards save hours of work
- PromQL powers all Grafana queries
- Alerts should have meaningful thresholds
- Dashboard provisioning via ConfigMaps
- Combine dashboards for full observability
