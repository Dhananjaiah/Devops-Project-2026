# S10.1: One-Command Automation (make up/down)

**Video Duration:** ~10 minutes  
**Story Points:** 3

---

## Learning Objectives

By the end of this video, you will be able to:
- Create platform orchestration Makefile
- Deploy entire platform with one command
- Destroy everything cleanly
- Understand idempotent operations

---

## Transcript

### Introduction (0:00 - 1:00)

Welcome to the final video! We've built an amazing platform. But spinning it up requires many commands across multiple tools.

Let's automate everything into `make up` and `make down`.

### The Makefile Approach (1:00 - 2:00)

Why Makefile?
- Simple, no dependencies
- Self-documenting
- Everyone knows how to use it
- Cross-platform (with small caveat for Windows)

### The Makefile Structure (2:00 - 5:00)

```makefile
.PHONY: up down infra k8s apps status help

help:
    @echo "make up   - Deploy entire platform"
    @echo "make down - Destroy everything"

up: infra k8s apps
    @echo "âœ… Platform deployed!"

down: down-apps down-k8s down-infra
    @echo "âœ… Platform destroyed!"

infra:
    cd techitfactory-infra/environments/dev && \
    terraform init && terraform apply -auto-approve
    aws eks update-kubeconfig --name techitfactory-dev

k8s: k8s-alb k8s-argocd k8s-monitoring
    @echo "âœ… Add-ons installed"

k8s-argocd:
    kubectl apply -n argocd -f https://...
    kubectl wait --for=condition=Ready pods -n argocd

apps:
    kubectl apply -f techitfactory-gitops/apps/root-app.yaml
```

Each target is a step. Dependencies chain them together.

### The `up` Command (5:00 - 6:30)

```bash
make up
```

*[Shows Makefile running]*

1. Deploys VPC, EKS, ECR with Terraform
2. Installs ALB Controller, ArgoCD, Prometheus
3. Deploys applications via ArgoCD

Total time: ~20 minutes

*[Shows successful completion]*

### The `down` Command (6:30 - 8:00)

```bash
make down
```

Order matters for destruction:
1. Delete Kubernetes resources first
2. Wait for load balancers to be removed
3. Destroy Terraform

```makefile
down-apps:
    kubectl delete namespace techitfactory --ignore-not-found

down-k8s:
    helm uninstall prometheus -n monitoring || true
    kubectl delete namespace argocd --ignore-not-found

down-infra:
    cd techitfactory-infra/environments/dev && \
    terraform destroy -auto-approve
```

*[Shows clean destruction]*

### Idempotency (8:00 - 9:00)

```bash
make up
make up  # Runs again - no errors!
```

The Makefile handles:
- `--ignore-not-found` for kubectl
- `|| true` for Helm
- Terraform's natural idempotency

You can run it multiple times safely.

### Status Command (9:00 - 9:30)

```makefile
status:
    @kubectl get nodes
    @kubectl get pods -n techitfactory
    @argocd app list
```

```bash
make status
```

Quick health check of the platform.

### Summary (9:30 - 10:00)

We created:
1. `make up` - One command to deploy
2. `make down` - One command to destroy
3. `make status` - Quick health check
4. Idempotent, reliable operations

The entire platform is now automated!

---

## ðŸŽ‰ Course Complete!

Congratulations! You've built a production-grade DevOps platform:

âœ… Infrastructure as Code (Terraform)  
âœ… Kubernetes on EKS  
âœ… GitOps with ArgoCD  
âœ… Observability (Prometheus, Grafana, Loki)  
âœ… CI/CD with GitHub Actions  
âœ… One-command automation  

You're ready for production DevOps! ðŸš€

---

## Key Takeaways

- Makefile provides simple orchestration
- Idempotent operations are critical
- Order matters for destruction
- `make up/down` is the industry standard
- Document your automation!
