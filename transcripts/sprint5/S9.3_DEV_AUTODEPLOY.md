# S9.3: Dev Environment Auto-Deploy

**Video Duration:** ~8 minutes  
**Story Points:** 2

---

## Learning Objectives

By the end of this video, you will be able to:
- Configure automatic dev deployments
- Implement health check verification
- Set up Slack notifications
- Handle deployment failures

---

## Transcript

### Introduction (0:00 - 0:30)

Welcome back! Merge to main, automatically deploy to dev. That's what we're building now.

### The Flow (0:30 - 1:30)

```
PR merged to main
       ↓
CI builds new image
       ↓
GitOps repo updated
       ↓
ArgoCD auto-syncs
       ↓
New version deployed
       ↓
Slack notification
```

We already have most of this. Let's add notifications and verification.

### Slack Notification (1:30 - 3:30)

```yaml
notify-deploy:
  needs: update-gitops
  runs-on: ubuntu-latest
  
  steps:
    - name: Send Slack notification
      uses: slackapi/slack-github-action@v1
      with:
        payload: |
          {
            "blocks": [
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": "✅ *Deployed to Dev*\n*Service:* ${{ matrix.service }}\n*Commit:* `${{ github.sha }}`\n*By:* ${{ github.actor }}"
                }
              }
            ]
          }
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

Create a Slack webhook:
1. Go to your Slack workspace
2. Apps → Add Incoming Webhook
3. Choose channel
4. Copy webhook URL
5. Add as GitHub secret

### Deployment Verification (3:30 - 5:30)

```yaml
verify-deploy:
  needs: update-gitops
  runs-on: ubuntu-latest
  
  steps:
    - name: Configure AWS
      uses: aws-actions/configure-aws-credentials@v4
      with:
        role-to-assume: ${{ secrets.AWS_ROLE_ARN }}
        aws-region: ap-south-1

    - name: Wait for ArgoCD sync
      run: sleep 60

    - name: Update kubeconfig
      run: aws eks update-kubeconfig --name techitfactory-dev

    - name: Wait for rollout
      run: |
        kubectl rollout status deployment/${{ matrix.service }} \
          -n techitfactory \
          --timeout=300s

    - name: Health check
      run: |
        POD=$(kubectl get pods -n techitfactory \
          -l app=${{ matrix.service }} \
          -o jsonpath='{.items[0].metadata.name}')
        kubectl exec -n techitfactory $POD -- \
          wget -q -O- http://localhost:3000/health
```

### Rollback on Failure (5:30 - 7:00)

```yaml
- name: Rollback on failure
  if: failure()
  run: |
    echo "Deployment failed, rolling back..."
    kubectl rollout undo deployment/${{ matrix.service }} -n techitfactory
    
    # Notify Slack about failure
    curl -X POST -H 'Content-type: application/json' \
      --data '{"text":"❌ Deployment FAILED for ${{ matrix.service }}"}' \
      ${{ secrets.SLACK_WEBHOOK_URL }}
```

### Demo (7:00 - 7:30)

*[Shows merge to main]*
*[Shows Slack notification]*
*[Shows successful deployment in ArgoCD]*

Everything automated!

### Summary (7:30 - 8:00)

We added:
1. Slack notifications
2. Deployment verification
3. Automatic rollback on failure
4. Full automation from merge to deploy

Next: Production releases with approval gates!

---

## Key Takeaways

- Merge to main triggers full pipeline
- Slack notifications keep team informed
- Health checks verify deployment success
- Automatic rollback prevents broken deployments
