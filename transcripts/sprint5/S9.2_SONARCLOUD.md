# S9.2: SonarCloud Integration (Optional)

**Video Duration:** ~8 minutes  
**Story Points:** 2

---

## Learning Objectives

By the end of this video, you will be able to:
- Set up SonarCloud for code quality
- Configure quality gates
- Enable PR decoration
- Integrate with GitHub Actions

---

## Transcript

### Introduction (0:00 - 0:30)

Welcome back! This video is optional but valuable - code quality scanning with SonarCloud.

### What SonarCloud Provides (0:30 - 1:30)

- **Bugs** - Potential runtime errors
- **Vulnerabilities** - Security issues
- **Code Smells** - Maintainability problems
- **Coverage** - Test coverage metrics
- **Duplications** - Copy-pasted code

It's free for open source projects!

### Setting Up SonarCloud (1:30 - 3:00)

1. Go to sonarcloud.io
2. Sign in with GitHub
3. Import techitfactory-app repository
4. Get your project token

Add token to GitHub secrets:
- Name: `SONAR_TOKEN`
- Value: [paste token]

### sonar-project.properties (3:00 - 4:00)

```properties
sonar.organization=techitfactory
sonar.projectKey=TechITFactory_techitfactory-app

sonar.sources=services
sonar.exclusions=**/node_modules/**,**/__pycache__/**

sonar.javascript.lcov.reportPaths=services/*/coverage/lcov.info
sonar.python.coverage.reportPaths=services/*/coverage.xml

sonar.qualitygate.wait=true
```

### GitHub Actions Integration (4:00 - 6:00)

```yaml
name: SonarCloud

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  sonarcloud:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Run tests with coverage
        run: |
          for dir in services/*/; do
            cd "$dir"
            npm test -- --coverage || true
            cd ../..
          done
      
      - name: SonarCloud Scan
        uses: SonarSource/sonarcloud-github-action@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
```

### Quality Gates (6:00 - 7:00)

Configure quality gate conditions:
- New Code Coverage >= 70%
- Bugs = 0
- Vulnerabilities = 0
- Code Smells (Major+) = 0

PRs are blocked if they fail the quality gate!

### PR Decoration (7:00 - 7:30)

SonarCloud comments on PRs:

```
âœ… Quality Gate passed

Coverage: 85.2%
Bugs: 0
Vulnerabilities: 0
Code Smells: 3 (minor)
```

### Summary (7:30 - 8:00)

We configured:
1. SonarCloud analysis
2. Quality gates
3. PR decoration
4. Coverage reporting

Code quality is now automated!

---

## Key Takeaways

- SonarCloud catches bugs before production
- Quality gates block bad PRs
- Free for open source
- Integrates seamlessly with GitHub
